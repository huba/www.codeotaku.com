
#include <iostream>
#include <opencv/cv.h>
#include <opencv/highgui.h>

const char * WindowName = "Video 01";

int main (int argc, const char * argv[]) {
	CvCapture * capture = NULL;
	IplImage * frame = NULL, * prevFrame = NULL, * diffFrame = NULL;
	int key = 0;
	
	// Initialize Camera
	capture = cvCaptureFromCAM(0);
	
	if (capture == NULL) {
		perror("Could not open camera device!");
		return 1;
	}
	
	frame = cvQueryFrame(capture);
	prevFrame = cvCloneImage(frame);
	diffFrame = cvCloneImage(frame);
	
	cvNamedWindow(WindowName, CV_WINDOW_AUTOSIZE);
	
	std::cout << "Frame : " << frame->width << ", " << frame->height << std::endl;
	
	while (key != 'q') {
		frame = cvQueryFrame(capture);
		
		if (frame == NULL) {
			perror("Could not get frame from device!");
			break;
		}
		
		cvAbsDiff(frame, prevFrame, diffFrame);
		cvThreshold(diffFrame, diffFrame, 32, 0, CV_THRESH_TOZERO);
		
		cvCopy(frame, prevFrame, NULL);
		
		cvShowImage(WindowName, diffFrame);

		key = cvWaitKey(1);
	}
	
	cvDestroyWindow(WindowName);
	cvReleaseCapture(&capture);

    return 0;
}
